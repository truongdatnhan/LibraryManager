create database Thuvien;
use Thuvien;
-- table nhân viên
create table NHANVIEN(
	MANV CHAR(10) NOT NULL,
    HONV NVARCHAR(50) NOT NULL,
    TENNV NVARCHAR(50) NOT NULL,
    NGAYSINH date,
    GIOITINH CHAR(5) CHECK ( GIOITINH IN("Nam","Nữ")),
    DIACHINV NVARCHAR(50),
    EMAILNV NVARCHAR(50),
    SDTNV CHAR(10) ,
    LUONG INT
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- table sách 
CREATE TABLE SACH(
	MASACH CHAR(10) NOT NULL,
    TENSACH NVARCHAR(50) NOT NULL,
    GIASACH INT,
    MATHELOAI CHAR(10),
    MATG CHAR(10),
    MANXB CHAR(10),
    MALINHVUC CHAR(10),
    SOLUONG INT
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- table đọc giả
CREATE TABLE DOCGIA (
	MADG CHAR(10) NOT NULL,
    HODG NVARCHAR(50) NOT NULL,
    TENDG NVARCHAR(50) NOT NULL,
    NGAYSINHDG date,
    DIACHIDG NVARCHAR(150),
    NGHENGHIEP NVARCHAR(30),
    TRINHDO NVARCHAR(50)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- table thẻ thư viện
CREATE TABLE THETHUVIEN (
	MATHE CHAR(10) NOT NULL,
    MADG CHAR(10) NOT NULL,
    NGAYCAP date,
    NGAYHETHAN date
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- table người dùng
CREATE TABLE NGUOIDUNG(
	MANV CHAR(10) NOT NULL,
    MATKHAU NVARCHAR(50) NOT NULL,
    MAQUYEN CHAR(10) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- table phân quyền
CREATE TABLE PHANQUYEN(
	MAQUYEN CHAR(10) NOT NULL,
    TENQUYEN NVARCHAR(30) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- table nhà cung cấp
CREATE TABLE NCC(
	MANCC CHAR(10) NOT NULL,
    TENNCC NVARCHAR(50),
    DIACHINCC NVARCHAR(50),
    SDTNCC CHAR(10)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- table lĩnh vực
CREATE TABLE LINHVUC(
	MALINHVUC CHAR(10) NOT NULL,
    TENLINHVUC NVARCHAR(50) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- table thể loại
CREATE TABLE THELOAI (
	MATHELOAI CHAR(10) NOT NULL,
    TENTHELOAI NVARCHAR(50) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- table nhà xuất bản
CREATE TABLE NXB(
	MANXB CHAR(10) NOT NULL,
    TENNXB NVARCHAR(50) NOT NULL,
    SDTNXB CHAR(10),
    EMAILNXB NVARCHAR(50)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- table tác giả 
CREATE TABLE TACGIA(
	MATG CHAR(10) NOT NULL,
    HOTG NVARCHAR(50) NOT NULL,
    TENTG NVARCHAR(20) NOT NULL,
    EMAILTG NVARCHAR(50)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- table phiếu nhập
CREATE TABLE PHIEUNHAP(
	MAPN CHAR(10) NOT NULL,
    MANV CHAR(10) NOT NULL,
	MANCC CHAR(10) NOT NULL,
	NGAYNHAP date NOT NULL,
    TONGTIEN INT NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- table chi tiết phiếu nhập
CREATE TABLE CTPHIEUNHAP(
	MAPN CHAR(10) NOT NULL,
    MASACH CHAR(10) NOT NULL,
    SOLUONG INT ,
    DONGIA INT,
    THANHTIEN INT
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- table phiếu mượn
CREATE TABLE  PHIEUMUON(
	MAPM CHAR(10) NOT NULL,
    MANV CHAR (10) NOT NULL,
    MATHE CHAR(10) NOT NULL,
    NGAYMUON date,
    NGAYQUIDINHTRA date
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- table chi tiết phiếu mượn 
CREATE TABLE CTPHIEUMUON(
	MAPM CHAR(10) NOT NULL,
    MASACH CHAR(10) NOT NULL,
    SOLUONG INT ,
    TINHTRANG NVARCHAR(50),
    NGAYTHUCTRA date
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- table phiếu phạt
CREATE TABLE PHIEUPHAT(
	MAPP CHAR(10) NOT NULL,
    MAPM CHAR(10) NOT NULL,
	MAQD CHAR(10),
    TIENPHAT INT,
    NGAYLAP DATE
)ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
CREATE TABLE QUYDINH(
	MAQD CHAR(10),
    TENQD VARCHAR(20),
    MUCPHAT INT
)ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
-- Khóa chính 
ALTER TABLE SACH ADD CONSTRAINT S_PK PRIMARY KEY(MASACH);
ALTER TABLE NHANVIEN ADD CONSTRAINT NV_PK PRIMARY KEY(MANV);
ALTER TABLE DOCGIA ADD CONSTRAINT DG_PK PRIMARY KEY(MADG);
ALTER TABLE TACGIA ADD CONSTRAINT TG_PK PRIMARY KEY(MATG);
ALTER TABLE NXB ADD CONSTRAINT NXB_PK PRIMARY KEY(MANXB);
ALTER TABLE NCC ADD CONSTRAINT NCC_PK PRIMARY KEY(MANCC);
ALTER TABLE LINHVUC ADD CONSTRAINT LV_PK PRIMARY KEY(MALINHVUC);
ALTER TABLE THETHUVIEN ADD CONSTRAINT TTV_PK PRIMARY KEY(MATHE);
ALTER TABLE THELOAI ADD CONSTRAINT TL_PK PRIMARY KEY(MATHELOAI);
ALTER TABLE PHIEUNHAP ADD CONSTRAINT PN_PK PRIMARY KEY(MAPN);
ALTER TABLE PHANQUYEN ADD CONSTRAINT PQ_PK PRIMARY KEY(MAQUYEN);
ALTER TABLE PHIEUMUON ADD CONSTRAINT PM_PK PRIMARY KEY(MAPM);
ALTER TABLE PHIEUPHAT ADD CONSTRAINT PP_PK PRIMARY KEY(MAPP);
ALTER TABLE QUYDINH ADD CONSTRAINT QD_PK PRIMARY KEY(MAQD);
-- Khóa ngoại của Sách 
ALTER TABLE SACH ADD CONSTRAINT S_TG_FK FOREIGN KEY(MATG) REFERENCES TACGIA(MATG);
ALTER TABLE SACH ADD CONSTRAINT S_NXB_FK FOREIGN KEY(MANXB) REFERENCES NXB(MANXB);
ALTER TABLE SACH ADD CONSTRAINT S_TL_FK FOREIGN KEY(MATHELOAI) REFERENCES THELOAI(MATHELOAI);
ALTER TABLE SACH ADD CONSTRAINT S_LVFK FOREIGN KEY(MALINHVUC) REFERENCES LINHVUC(MALINHVUC);
-- Khóa ngoại của thẻ thư viện
ALTER TABLE THETHUVIEN ADD CONSTRAINT TTV_DG_FK FOREIGN KEY(MADG) REFERENCES DOCGIA(MADG);
-- Khóa ngoại của phiếu nhập 
ALTER TABLE PHIEUNHAP ADD CONSTRAINT PN_NV_FK FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV);
ALTER TABLE PHIEUNHAP ADD CONSTRAINT PN_NCC_FK FOREIGN KEY(MANCC) REFERENCES NCC(MANCC);
-- Khóa ngoại chi tiết phiếu nhập 
ALTER TABLE CTPHIEUNHAP ADD CONSTRAINT CTPN_PN_FK FOREIGN KEY(MAPN) REFERENCES PHIEUNHAP(MAPN);
ALTER TABLE CTPHIEUNHAP ADD CONSTRAINT CTPN_S_FK FOREIGN KEY(MASACH) REFERENCES SACH(MASACH);
-- Khóa ngoại phiếu mượn
ALTER TABLE PHIEUMUON ADD CONSTRAINT PM_NV_FK FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV);
ALTER TABLE PHIEUMUON ADD CONSTRAINT PM_TTV_FK FOREIGN KEY(MATHE) REFERENCES THETHUVIEN(MATHE);
-- Khóa ngoại chi tiêt phiếu mượn
ALTER TABLE CTPHIEUMUON ADD CONSTRAINT CTPM_PM_FK FOREIGN KEY(MAPM) REFERENCES PHIEUMUON(MAPM);
ALTER TABLE CTPHIEUMUON ADD CONSTRAINT CTPM_S_FK FOREIGN KEY(MASACH) REFERENCES SACH(MASACH);
-- Khóa ngoại của người dùng 
ALTER TABLE NGUOIDUNG ADD CONSTRAINT ND_NV_FK FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV);
ALTER TABLE NGUOIDUNG ADD CONSTRAINT ND_Q_FK FOREIGN KEY(MAQUYEN) REFERENCES PHANQUYEN(MAQUYEN);
-- Khóa ngoại phiếu phạt
ALTER TABLE PHIEUPHAT ADD CONSTRAINT PP_PM_FK FOREIGN KEY(MAPM) REFERENCES PHIEUMUON(MAPM);
ALTER TABLE PHIEUPHAT ADD CONSTRAINT PP_QD_FK FOREIGN KEY(MAQD) REFERENCES QUYDINH(MAQD);

INSERT INTO TACGIA(MATG,HOTG,TENTG,EMAILTG) VALUES
('TG001','Nguyễn Nhật','Ánh','anh123@gmail.com'),
('TG002','Robin','S00harma','S00harma@gmail.com'),
('TG003','Phạm Thế','Bảo','bao@gmail.com'),
('TG004','GoSho','Aoyama','aoyama@gmail.com'),
('TG005','Đồng Thị Bích','Thủy','thuy@gmail.com'),
('TG006','Walker','Matthew','matthew@gmail.com'),
('TG007','Carnegie','Dale','dalebg@gmail.com'),
('TG008','NG','CeleS00te','cel@gmail.com'),
('TG009','André','Aciman','aciman@gmail.com');

INSERT INTO THELOAI(MATHELOAI,TENTHELOAI) VALUES
('TL001','Truyện dài'),
('TL002','Phát triển bản thân'),
('TL003','Giáo trình'),
('TL004','Truyện thiếu nhi'),
('TL005','Tiểu thuyết');

INSERT INTO NXB(MANXB,TENNXB,SDTNXB,EMAILNXB) VALUES
('NXB001','NXB00 Trẻ','0123456987','tre@gamil.com'),
('NXB002','NXB00 Đại Học Quốc Gia TP Hồ Chí Minh','0937343029','NXB00dhqg@gamil.com'),
('NXB003','NXB00 Kim Đồng ','0948523716','NXB00kimdong@gmail.com'),
('NXB004','NXB00 Khoa Học và Kỹ Thuật ','0987412365','ktvacn@gmail.com'),
('NXB005','NXB00 Lao Động','0948756321','laodonglahanhphuc@gmail.com'),
('NXB006','NXB00 Văn học','0852369741','vanhoa@gmail.com');
INSERT INTO LINHVUC(MALINHVUC,TENLINHVUC) VALUES
('LV001','Văn học'),
('LV002','Kinh tế'),
('LV003','Công nghệ thông tin'),
('LV004','Khoa học'),
('LV005','Giao tiếp');
INSERT INTO SACH(MASACH,TENSACH,GIASACH,MATHELOAI,MATG,MANXB,MALINHVUC,SOLUONG) VALUES
('S001','Mắt Biếc',110000,'TL001','TG001','NXB001','LV001',3),
('S002','Nhà lãnh đạo không chức danh ',80000,'TL002','TG002','NXB001','LV002',5),
('S003','Cấu trúc dữ liệu và giải thuật',14000,'TL003','TG003','NXB002','LV003',7),
('S004','Thám tử lừng danh conan -  tập 96',20000,'TL004','TG004','NXB003','LV001',8),
('S005','Giáo trình cơ Sở dư liệu',35000,'TL003','TG005','NXB004','LV003',2),
('S006','Sao chúng ta lại ngủ',249000,'TL002','TG006','NXB005','LV004',10),
('S007','Tôi thấy hoa vàng trên cỏ xanh',82000,'TL001','TG001','NXB001','LV001',2),
('S008','Khéo ăn nói Sẽ có được thiên hạ',110000,'TL002','TG006','NXB006','LV005',6),
('S009','Bao điều không nói',120000,'TL005','TG007','NXB001','LV001',5),
('S010','Gọi em bầng tên anh',98000,'TL005','TG008','NXB001','LV001',3);

INSERT INTO DOCGIA(MADG,HODG,TENDG,NGAYSINHDG,DIACHIDG,NGHENGHIEP,TRINHDO) VALUES 
('DG001','Nguyễn Phương','Nam','2000-9-3','Đồng Nai','Sinh viên','Sinh viên đại học'),
('DG002','Tất Khánh','Nam','2000-9-7','TP Hồ Chí Minh','Sinh viên','Sinh viên đại học'),
('DG003','Trần Yến','Nhi','2000-1-1','TP Hồ Chí Minh','Sinh viên','Sinh viên đại học'),
('DG004','Trương Đạt','Nhân','2000-1-1','Ninh Thuận','Sinh viên','Sinh viên đại học');

INSERT INTO THETHUVIEN(MATHE,MADG,NGAYCAP,NGAYHETHAN) VALUES
('TTV001','DG001','2020-4-25','2021-4-25'),
('TTV002','DG002','2020-4-25','2021-4-25'),
('TTV003','DG003','2020-4-25','2021-4-25'),
('TTV004','DG004','2020-4-25','2021-4-25');


INSERT INTO NHANVIEN(MANV,HONV,TENNV,NGAYSINH,GIOITINH,DIACHINV,EMAILNV,SDTNV,LUONG) VALUES
('NV001','Nguyễn Phú','Sơn','1995-9-21','Nam','54 An Dương Vương quận 5 TP Hồ Chí Minh','son@gmail.com','0985236471','8000000'),
('NV002','Nguyễn Thị Minh','Nguyệt','1997-3-2','Nữ','18 Bà Huyện Thanh Quan quận 3 TP Hồ Chí Minh','nguyetminh@gmail.com','0857412369','6500000'),
('NV003','Hoàng Minh','Trang','1997-8-3','Nữ','21 Lạc Long Quân quân 10 TP Hồ Chí Minh','trang@gmail.com','0857412378','6500000');

INSERT INTO PHANQUYEN(MAQUYEN,TENQUYEN) VALUES 
('MQ001','Quản lí'),
('MQ002','Thủ thư');	

INSERT INTO NGUOIDUNG(MANV,MATKHAU,MAQUYEN) VALUES 
('NV001','123456','MQ001'),
('NV002','123456','MQ002'),
('NV003','123456','MQ002');

INSERT INTO NCC(MANCC,TENNCC,DIACHINCC,SDTNCC) VALUES 
('NCC001','NCC Sao Mai','75 Nguyến Thi Minh Khai quân 1 TP Hồ Chí Minh','0853214796'),
('NCC002','NCC Mặt trời','45 Đinh Tiên Hoàng quân 1 TP Hồ Chí Minh','0853269596'),
('NCC003','NCC Mặt trăng','15 Điện Biên Phủ quân Bình Thạnh TP Hồ Chí Minh','0882214796');

INSERT INTO PHIEUNHAP(MAPN,MANV,MANCC,NGAYNHAP,TONGTIEN) VALUES
('PN001','NV001','NCC001','2020-5-7',470000),
('PN002','NV001','NCC002','2020-5-7',1718000),
('PN003','NV002','NCC002','2020-5-10',588000),
('PN004','NV002','NCC001','2020-5-11',24900000);

INSERT INTO CTPHIEUNHAP(MAPN,MASACH,SOLUONG,DONGIA,THANHTIEN) VALUES 
('PN001','S002',5,80000,400000),
('PN001','S005',2,35000,70000),
('PN002','S010',3,98000,294000),
('PN002','S009',5,120000,6000000),
('PN002','S008',6,110000,660000),
('PN002','S007',2,82000,164000),
('PN003','S001',3,110000,330000),
('PN003','S003',7,14000,98000),
('PN003','S004',8,20000,160000),
('PN004','S006',10,249000,2490000);

INSERT INTO PHIEUMUON(MAPM,MANV,MATHE,NGAYMUON,NGAYQUIDINHTRA) VALUES
('PM001','NV003','TTV001','2020-5-11','2020-6-14');

INSERT CTPHIEUMUON(MAPM,MASACH,SOLUONG,TINHTRANG,NGAYTHUCTRA) VALUES 
('PM001','S006',1,'Đã trả','2020-5-30');

INSERT QUYDINH(MAQD,TENQD,MUCPHAT) VALUES 
('QD001','Mất sách','50000'),
('QD002','Rách sách','10000'),
('QD003','Trễ hạn','2000');-- tính theo ngày